Після видалення об'єкту з пам'яті [[Garbage collector|garbage collector'ом]] в пулі пам'яті, який Python запросив у операційної системи, цей фрагмент пам'яті зберігається зарезервованим для того щоб в разі необхідності покласти туди інший об'єкт із таким ж розміром. Таким чином Python економить ресурси і не робить повторний запит на виділення пам'яті в операційної системи.

[[Внутрішня будова]]

## Організація пам'яті

**Пам'ять Python** організована на основі _куп_, що забезпечує динамічне виділення і звільнення пам'яті та підходить для зберігання об'єктів різних розмірів.

### Категорії пам'яті в Python

| **Тип пам’яті**             | **Призначення**                                                                                                  |
| --------------------------- | ---------------------------------------------------------------------------------------------------------------- |
| **Obj speciffic memory**    | Зберігання об’єктів з оптимізованим управлінням, використовуючи спеціальні алокатори для вбудованих типів даних. |
| **Non-obj memoory**         | Пам'ять для потреб інтерпретатора (стеки викликів, таблиці символів, інформація про потоки тощо).                |
| **Obj memory**              | Пам'ять для зберігання даних та метаданих Python-об’єктів.                                                       |
| **Internal buffers memory** | Тимчасові області для кешування, буферизації вводу/виводу та проміжних обчислень.                                |

---

## Алокатори памяті

**Алокатор пам’яті** — це менеджер памяті, що відповідає за виділення і звільнення пам’яті для програм, які її потребують.

CPython використовує вбудовані в C функції `malloc` і `free` для запиту памяті в ОС (тоді розміір купи збільшується) та її вивільнення назад. Для ефективності інтерпритатор використовує різні алокатори, що оптимізують пам’ять для об’єктів різних розмірів.

| **Рівень**                        | **Призначення**                                                                               | Розмір      |
| --------------------------------- | --------------------------------------------------------------------------------------------- | ----------- |
| **Універсальний алокатор**        | Базується на `malloc`, всі інші алокатори можуть використовуувати цей як основу.              | >512 байтів |
| **Алокатор необробленої пам’яті** | Виділяє пам’ять для великих об’єктів, мінімізує оптимізації, можливе виникнення фрагментації. | >512 байтів |
| **Алокатор об’єктів**             | Для об’єктів . Використовує структури _арени_, _пули_ та _блоки_.                             | ≤512 байтів |
| **Специфічні алокатори**          | Оптимізовані для конкретних типів об’єктів (списки, словники, кортежі).                       | -           |


### Логіка вибору алокатора

![[obj allocation.png|500]]

---
## Алокатор об’єктів

1. **Арена**:
    - Велика область пам’яті (256 КБ), виділена ОС.
    - Містить кілька пулів.
2. **Пул**:
    - Фрагмент пам’яті (4 КБ) фіксованого розміру.
    - Містить блоки із певним розміром
3. **Блок**:
	- Найменша одиниця пам’яті (8, 16, 24 ... 512 байт).

> [!info] Аллокатор обєктів підбирає пули із конкретним розміром блоку
> Для виділення памяті для обєкту який займає 15 байт, алокатор обере пул із найближчим розміром блоку (16 байт). 